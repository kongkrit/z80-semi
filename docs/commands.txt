#!/bin/sh

sdasz80 -o startup-0.rel startup-0.s
sdcc -mz80 --std c99 --Werror -c nmi-0.c -o nmi-0.rel
sdcc -mz80 --std c99 --Werror -c main-0.c -o main-0.rel

#linker that works
#XXXXXXXXXXXX
sdcc -mz80 --no-std-crt0 startup-0.rel nmi-0.rel main-0.rel -Wl-b_NMI_SEG=0x0066 -Wl-b_CODE=0x0090 -Wl-b_DATA=0x00D0 -o test.ihx
#XXXXXXXXXXXXXXX
sdld startup-0.rel nmi-0.rel main-0.rel -f link.txt -o test.ihx
#XXXXXXXXXXXXXXXX
!!!
sdcc -mz80 --no-std-crt0 startup-0.rel nmi-0.rel main-0.rel -Wl-b_NMI_SEG=0x0066 --code-loc 0x0090 --data-loc 0x00D0 -o startup-0.ihx
!!!

reference SDCC manual: https://sdcc.sourceforge.net/doc/sdccman.pdf

sdasz80 00-head.s -o 00-head.rel


i want a makefile that does this:



if any *.s exists, do: sdasz80 name.s -o name.rel

if any *.c exists, do: sdcc -mz80 --std c99 --Werror -c name.c -o name.rel



then make a set:

if 00-reset.rel 00-nmi_isr.rel 00-code.rel 00-link.param



sdasz80 -o 00-reset.rel 00-reset.s
sdcc -mz80 --std c99 --Werror -c 00-nmi_isr.c -o 00-nmi_isr.rel
sdcc -mz80 --std c99 --Werror -c 00-main.c -o 00-main.rel
# sdld 00-reset.rel 00-nmi_isr.rel 00-main.rel -f 00-link.txt -o test.ihx
sdcc -mz80 --no-std-crt0 00-reset.rel 00-nmi_isr.rel 00-main.rel -Wl-b_NMI_SEG=0x0066 -Wl-b_CODE=0x0090 -Wl-b_DATA=0x00D0 -o 00.ihx


# sdcc -mz80 --std c99 --Werror -c 01-nmi_isr.c -o 01-nmi-0.rel

# sdcc -mz80 --std c99 --Werror -c main-0.c -o main-0.rel

sdasz80 -o 01-reset.rel 01-reset.s
sdcc -mz80 --std c99 --Werror -c 01-nmi_isr.c
sdcc -mz80 --std c99 --Werror -c 01-main.c

# sdcc -mz80 --no-std-crt0 startup-0.rel nmi-0.rel main-0.rel -Wl-b_NMI_SEG=0x0066 --code-loc 0x0090 --data-loc 0x00D0 -Wl-gSTACK_TOP=0x0100 -o startup-0.ihx

sdcc -mz80 --no-std-crt0 01-reset.rel 01-nmi_isr.rel 01-main.rel --code-loc 0x0070 --data-loc 0x00D0 -Wl-gSTACK_TOP=0x0100 -o 00-run.ihx

sdcc -mz80 --no-std-crt0 01-reset.rel 01-nmi_isr.rel 01-main.rel --code-loc 0x0070 --data-loc 0x00D0 -Wl-gSTACK_TOP=0x0100 -o 00-run.ihx

sdobjcopy -I ihex -O binary 00-run.ihx 00-run.bin



i want a make file that goes from 01-reset.s 01-nmi_isr.c 01-main.c to do this:


sdasz80 -o 01-reset.rel 01-reset.s
sdcc -mz80 --std c99 --Werror -c 01-nmi_isr.c
sdcc -mz80 --std c99 --Werror -c 01-main.c
sdcc -mz80 --no-std-crt0 01-reset.rel 01-main.rel 01-nmi_isr.rel --code-loc 0x0070 --data-loc 0x00D0 -Wl-gSTACK_TOP=0x0100 -o 01-run.ihx
sdobjcopy -I ihex -O binary 01-run.ihx 01-run.bin

and eventually get 01-run.bin

i want this code to work for 02-* 03-* 04-* and so on...
